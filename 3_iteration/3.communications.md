# Коммуникации между сервисами

1. Сервис отсева коммуницирует только с сервисом юзеров
(когда требуется добавить нового воркера по результатам тестов).
Коммуникации синхронные (request-response),
т.к. стоит поскорее сообщить системе о появлении нового сотрудника, на которого сразу могут быть назначены задачи.
2. Между сервисом сборки расходников и системой производства печений -- синхронная коммуникация,
потому что производство печений -- это внешняя система и тут по-другому никак.
Также сервис сборки расходников должен получать уведомления от сервиса менеджмента заказов о том, что заказу назначен воркер.
Можно было бы реализовать и синхронно, но т.к. это событие может быть интересно и другим сервисам
(например, проверке качества или тем, которые появятся в будущем),
то удобно построить асинхронную коммуникацию на основе event-driven:
сервис менеджмента продьюсит сообщение о том, что воркер подобран, а сервис сборки расходников его обрабатывает.
3. Система ставок имеет только входящие коммуникации.
Удобнее всего сделать их событиями о том, что заказ перешел в финальное состояние: завершен, отменен, провален.
Потому что скорость получения данных не важна, а нагружать менеджмент заказов дополнительной апишкой нет смысла.
4. Между сервисом матчинга и сервисом менеджмента заказов также выбираем event-driven коммуникацию.
Потому что сервис менеджмента будет высоконагруженным (минимум 10 заказов в минуту), и нет смысла нагружать еще и сервис матчинга.
Так что при создании нового заказа сервис менеджмента просто отправит событие в матчинг.
Когда воркер подберется под заказ, событие об этом будет отправлено из матчинга в менеджмент.
5. Между контролем качества и менеджментом заказов выбираем сразу 2 вида коммуникации:
   - event-driven -- это когда сервис менеджмента отправляет событие в контроль качества о том, что заказ отменился или провалился;
   - request-response -- это для того чтобы менеджеры могли запрашивать из сервиса менеджмента заказов списки заказов для проверки качества успешно завершенных заказов.
6. Между менеджментом заказов и каждым из двух сервисов биллинга выбираем асинхронную коммуникацию (event-driven):
   - когда заказ перешел в финальное состояние, сервис менеджмента уведомит об этом биллинги через событие;
   - когда конкретный заказ будет оплачен, или когда за него будет выплачено вознаграждение, сервисы биллингов отправять об этом событие.

   Асинхронная коммуникация тут удобна, потому что нет необходимости мгновенно доставлять информацию о завершении заказа в сервисы биллингов.
    А также потому, что события о переходе заказа в финальный статус интересны еще сервисам системы ставок и проверки качества.
